#global!/usr/bin/env bash

set -euo pipefail

# Fetch all installed tools and their versions as JSON
installed_tools_json=$(mise ls --installed --json)

# Present the list of tool names for user selection
tool_name=$(echo "$installed_tools_json" | jq -r 'keys[]' | fzf)
if [[ -z "$tool_name" ]]; then
   echo "No tool selected"
   exit 1
fi

# Present the list of installed versions for the selected tool
tool_versions=$(echo "$installed_tools_json" | jq -r --arg tool "$tool_name" '.[$tool][] | .version')
selected_version=$(echo "$tool_versions" | fzf)
if [[ -z "$selected_version" ]]; then
   echo "No version selected for $tool_name"
   exit 1
fi

# Set the selected version globally for the chosen tool
mise use --global "${tool_name}@${selected_version}"
